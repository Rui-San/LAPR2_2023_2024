@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

title US008 - System Sequence Diagram (SSD)

autonumber

actor "Fleet Manager" as Employee
participant ":ListVehiclesNeedingCheckupUI" as UI
participant ":ListVehiclesNeedingCheckupController" as CTRL
participant ":Repositories" as Repos
participant "repositories\n:Repositories" as PLAT
participant "checkupRepositoty\n:CheckupRepository" as CheckupRepo
participant "vehicleRepository" as VRepo

    Employee -> UI : Requests to show the list of \nvehicles needing a check-up
    activate UI

        UI -> CTRL** : create
        UI -> CTRL : getVehiclesNeedingCheckup()
        activate CTRL

            CTRL -> Repos : getInstance()
            activate Repos

                Repos --> CTRL : repositories
            deactivate Repos

            CTRL -> PLAT : getCheckupRepository()
            activate PLAT

                PLAT --> CTRL : checkupRepository
            deactivate PLAT

            CTRL -> CheckupRepo : getCheckupsList()
            activate CheckupRepo

                CheckupRepo --> CTRL : checkupsList
            deactivate CheckupRepo

            note right of CTRL
                the controller saves the checkupsList in list:
                List<Checkup> checkupsList
            end note


            CTRL -> PLAT : getVehicleRepository()
            activate PLAT

                PLAT --> CTRL : vehicleRepository
            deactivate PLAT

            CTRL-> VRepo : getVehiclesNeedingCheckup( List<Checkup> checkupsList )
            activate VRepo

                VRepo --> VRepo : getVehicles()

                loop for each vehicle in vehiclesList
                    VRepo --> VRepo : needsCheckup(Vehicle vehicle)
                    activate VRepo

                        VRepo --> VRepo : getLastCheckupKms( List<Checkup> checkupsList,\n Vehicle vehicle )
                        note right of VRepo
                            here, the method checks if the difference of the kms since the last checkup
                            is close to 5% of the checkup frequency; if it is, return true, else false
                        end note
                        VRepo --> VRepo : true/false
                    deactivate VRepo
                    VRepo --> VRepo : addVehicleToNeedCheckupList(vehicle)
                end loop
                VRepo -> CTRL : vehiclesNeedingCheckupList
            deactivate VRepo
            CTRL -> UI : vehiclesNeedingCheckupList
        deactivate CTRL

        UI -> Employee : Shows the list of vehicles needing check-up with \nvehicle details and the data used.

    deactivate UI

@enduml